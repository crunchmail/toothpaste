<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
    * {
        box-sizing: border-box;
    }
    .container-iframe {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        /*48*/
        overflow: hidden;
    }
    iframe {
        width: 100%;
        height: 100%;
    }
    body {
        background: #999;
    }
    </style>
</head>

<body>
    <div class="container-iframe">
        <iframe id="tabiframe-app" frameborder="0"></iframe>
    </div>
    <script>

    var settings = {
        "iframeId": "tabiframe-app",
        "apiUrl": "https://api.munch/",
        "token": ""
    };

    var iframe = document.getElementById("tabiframe-app");
    var data = {
        "identifier": "api",
        "password":"API_KEY"
    };

    var request = new XMLHttpRequest();
    request.open('POST', settings.apiUrl + "api-token-auth/", true);
    request.setRequestHeader('Content-Type', 'application/json');
    request.setRequestHeader('Accept', 'application/json');

    request.onload = function() {
      if (request.status >= 200 && request.status < 400) {
        // Success!
        var resp = request.responseText;

        settings.token = JSON.parse(resp).token;

        iframe.src= 'http://localhost:4000/ENV/#!/?apiUrl=' + settings.apiUrl + '&apiKey=SECRET&token=' + settings.token;
      } else {
        // We reached our target server, but it returned an error

      }
    };

    request.onerror = function() {
      // There was a connection error of some sort
    };

    request.send(JSON.stringify(data));

    window.addEventListener("message", receiveMessage, false);

    function receiveMessage(event) {
        console.log(event);
    }

    </script>
</body>
</html>
